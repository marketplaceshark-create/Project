<div class="dashboard-container">
    <aside class="sidebar">
        <h3>Admin Panel</h3>
        <nav>
            @for (tab of tabs; track tab.id) {
                <button [class.active]="activeTab() === tab.id" (click)="switchTab(tab.id)">
                    {{ tab.icon }} {{ tab.label }}
                </button>
            }
        </nav>
    </aside>

    <main class="content">
        <header>
            <h2>{{ activeTab() | titlecase }} Management</h2>
            <button class="btn-add" (click)="openAdd()">+ Add New</button>
        </header>

        <div class="table-wrapper">
            @if (loading()) { <p>Loading...</p> } 
            @else {
                <table>
                    <thead>
                        <tr>
                            @for (col of currentSchema(); track col.key) {
                                <th>{{ col.label }}</th>
                            }
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (row of tableData(); track row.id) {
                            <tr>
                                @for (col of currentSchema(); track col.key) {
                                    <td>
                                        @if (col.key.includes('Image')) {
                                            <img [src]="row[col.key]" height="40" alt="img" 
                                                 onerror="this.style.display='none'">
                                        } @else {
                                            {{ row[col.key] }}
                                        }
                                    </td>
                                }
                                <td>
                                    <button class="btn-edit" (click)="openEdit(row)">‚úèÔ∏è</button>
                                    <button class="btn-del" (click)="deleteRow(row.id)">üóëÔ∏è</button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </main>

    <!-- GENERIC MODAL -->
    @if (isModalOpen()) {
        <div class="modal-backdrop">
            <div class="modal">
                <h3>{{ isEditMode() ? 'Edit' : 'Add' }} Record</h3>
                
                <form (submit)="saveItem(); $event.preventDefault()">
                    @for (field of currentSchema(); track field.key) {
                        <div class="form-group">
                            <label>{{ field.label }}</label>
                            
                            <!-- FIXED: Using the helper method updateField -->
                            <input 
                                [type]="field.type" 
                                [ngModel]="currentItem()[field.key]" 
                                (ngModelChange)="updateField(field.key, $event)"
                                [name]="field.key"
                                class="form-control"
                            >
                        </div>
                    }

                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    }
</div>